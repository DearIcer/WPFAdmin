<UserControl x:Class="Client.Views.RoleManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题和添加按钮 -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="角色管理" Style="{StaticResource MaterialDesignHeadline5TextBlock}" 
                       VerticalAlignment="Center" />
            <Button Content="添加角色" 
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Command="{Binding AddRoleCommand}"
                    Margin="20,0,0,0"
                    Background="{DynamicResource PrimaryHueMidBrush}"
                    BorderBrush="{DynamicResource PrimaryHueMidBrush}" />
        </StackPanel>

        <!-- 角色列表和菜单配置 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <!-- 角色列表 -->
            <DataGrid Grid.Column="0"
                      ItemsSource="{Binding Roles}"
                      SelectedItem="{Binding SelectedRole}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      Margin="0,0,10,0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="角色名称" Binding="{Binding Name}" />
                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" />
                    <DataGridTemplateColumn Header="操作">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="编辑" 
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding DataContext.EditRoleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                    <Button Content="分配菜单" 
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding DataContext.AssignMenusCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                    <Button Content="删除" 
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Command="{Binding DataContext.DeleteRoleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Foreground="Red" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- 角色详情 -->
            <Grid Grid.Column="1" DataContext="{Binding SelectedRole}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="角色详情" 
                           Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                           Margin="0,0,0,10" />

                <StackPanel Grid.Row="1">
                    <TextBlock Text="角色名称:" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                    <TextBlock Text="{Binding Name}" Margin="0,0,0,10" />
                    
                    <TextBlock Text="角色描述:" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                    <TextBlock Text="{Binding Description}" Margin="0,0,0,10" />
                </StackPanel>
            </Grid>
        </Grid>

        <!-- 添加/编辑角色对话框 -->
        <materialDesign:DialogHost Grid.Row="0" Grid.RowSpan="2" 
                                   IsOpen="{Binding IsDialogOpen}"
                                   DialogTheme="Inherit">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="20" MinWidth="300">
                    <TextBlock Text="{Binding DialogTitle}" 
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Margin="0,0,0,20" />
                    
                    <TextBox Text="{Binding RoleName, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="角色名称"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Margin="0,0,0,15" />
                    
                    <TextBox Text="{Binding RoleDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="角色描述"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Margin="0,0,0,20"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="80" />
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="取消"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CloseDialogCommand}"
                                Margin="0,0,10,0" />
                        <Button Content="保存"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding SaveRoleCommand}"
                                Background="{DynamicResource PrimaryHueMidBrush}"
                                BorderBrush="{DynamicResource PrimaryHueMidBrush}" />
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
        
        <!-- 分配菜单对话框 -->
        <materialDesign:DialogHost Grid.Row="0" Grid.RowSpan="2" 
                                   IsOpen="{Binding IsAssignMenusDialogOpen}"
                                   DialogTheme="Inherit">
            <materialDesign:DialogHost.DialogContent>
                <StackPanel Margin="20" MinWidth="400" MaxWidth="600">
                    <TextBlock Text="{Binding AssignMenusDialogTitle}" 
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               Margin="0,0,0,20" />
                    
                    <TextBlock Text="{Binding SelectedRole.Name, StringFormat='为角色 {0} 分配菜单'}"
                               Style="{StaticResource MaterialDesignBody1TextBlock}"
                               Margin="0,0,0,10" />
                    
                    <ScrollViewer MaxHeight="400" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding MenuItems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <CheckBox Content="{Binding Name}"
                                                  IsChecked="{Binding IsAssigned}"
                                                  Margin="0,5" />
                                        <ItemsControl ItemsSource="{Binding Children}" 
                                                      Margin="20,0,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel>
                                                        <CheckBox Content="{Binding Name}"
                                                                  IsChecked="{Binding IsAssigned}"
                                                                  Margin="0,5" />
                                                        <ItemsControl ItemsSource="{Binding Children}" 
                                                                      Margin="20,0,0,0">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <CheckBox Content="{Binding Name}"
                                                                              IsChecked="{Binding IsAssigned}"
                                                                              Margin="0,5" />
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="取消"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CloseAssignMenusDialogCommand}"
                                Margin="0,0,10,0" />
                        <Button Content="保存"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Command="{Binding SaveAssignMenusCommand}"
                                Background="{DynamicResource PrimaryHueMidBrush}"
                                BorderBrush="{DynamicResource PrimaryHueMidBrush}" />
                    </StackPanel>
                </StackPanel>
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
    </Grid>
</UserControl>